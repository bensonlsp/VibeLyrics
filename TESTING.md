# 測試和調試指南

## 問題診斷步驟

### 1. 訪問診斷工具

如果主頁面載入失敗，請訪問：
```
https://bensonlsp.github.io/VibeLyrics/debug.html
```

診斷工具會自動測試所有 CDN 來源，並提供詳細的載入日誌。

### 2. 查看瀏覽器控制台

1. 開啟瀏覽器開發者工具（F12 或右鍵 → 檢查）
2. 切換到「Console」（控制台）標籤
3. 重新載入頁面
4. 查看詳細的載入日誌：
   - `Kuromoji 庫已載入，準備載入字典...` - 表示基礎庫載入成功
   - `[1/3] 嘗試載入: jsDelivr` - 顯示當前嘗試的 CDN
   - `載入中... 已耗時 X.X 秒` - 每 5 秒更新的進度
   - `✓ jsDelivr 載入成功！耗時: X.XX 秒` - 成功訊息
   - `✗ jsDelivr 失敗 (耗時 X秒)` - 失敗訊息

### 3. 檢查網路連線

Kuromoji 字典檔案約 **20MB**，確保：
- 網路連線穩定
- 下載速度足夠（建議至少 1Mbps）
- 沒有被防火牆或廣告攔截器阻止

### 4. 已知問題和解決方案

#### 問題：一直顯示「正在載入形態素分析引擎...」

**可能原因：**
- CDN 在你的地區無法訪問
- 網路速度太慢導致超時（每個 CDN 超時時間為 45 秒）
- 防火牆或瀏覽器安全設定阻止載入

**解決方案：**
1. 使用診斷工具 (debug.html) 測試各個 CDN
2. 嘗試使用 VPN 切換到其他地區
3. 使用無痕模式或其他瀏覽器
4. 暫時關閉瀏覽器擴充功能（特別是廣告攔截器）
5. 清除瀏覽器快取後重試

#### 問題：顯示「Kuromoji 庫無法載入」

**可能原因：**
- jsDelivr CDN 無法訪問
- 網頁的 `<script>` 標籤被阻止

**解決方案：**
1. 檢查瀏覽器控制台是否有 CORS 錯誤
2. 確認沒有內容安全策略 (CSP) 阻止外部腳本
3. 嘗試其他網路環境

### 5. CDN 來源列表

應用程式會依序嘗試以下 CDN：

1. **jsDelivr** (主要)
   - 路徑: `https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/dict/`
   - 超時: 45 秒

2. **jsDelivr (Fastly 節點)**
   - 路徑: `https://fastly.jsdelivr.net/npm/kuromoji@0.1.2/dict/`
   - 超時: 45 秒

3. **unpkg** (備用)
   - 路徑: `https://unpkg.com/kuromoji@0.1.2/dict/`
   - 超時: 45 秒

如果所有來源都失敗，會顯示詳細的錯誤訊息和建議。

### 6. 成功載入的標準

當成功載入時，你應該看到：
- 載入指示器消失
- 主要內容區域顯示（輸入框、解析按鈕等）
- 控制台顯示成功訊息和耗時統計
- 可以正常使用日文解析功能

### 7. 效能基準

參考載入時間（取決於網路速度）：
- **快速網路** (10Mbps+): 5-15 秒
- **中等網路** (3-10Mbps): 15-30 秒
- **慢速網路** (1-3Mbps): 30-45 秒
- **超過 45 秒**: 會自動切換到下一個 CDN

### 8. 聯繫和反饋

如果問題持續存在：
1. 在 debug.html 中截圖完整的日誌
2. 記錄你的網路環境和地區
3. 在 GitHub Issues 中回報問題

---

## 最近更新

### 2026-01-03 - 改進載入機制

- ✅ 添加多 CDN 備援機制
- ✅ 實現 45 秒超時保護
- ✅ 添加視覺化進度條
- ✅ 新增獨立診斷工具 (debug.html)
- ✅ 改進錯誤訊息和解決建議
- ✅ 添加詳細的控制台日誌
- ✅ 顯示載入耗時統計
